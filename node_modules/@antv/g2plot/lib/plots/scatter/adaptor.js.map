{"version":3,"file":"adaptor.js","sourceRoot":"","sources":["../../../src/plots/scatter/adaptor.ts"],"names":[],"mappings":"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","sourcesContent":["import { deepMix } from '@antv/util';\nimport { Params } from '../../core/adaptor';\nimport { flow } from '../../utils';\nimport { point as pointAdaptor } from '../../adaptor/geometries';\nimport { tooltip, interaction, animation, theme, scale, annotation } from '../../adaptor/common';\nimport { findGeometry } from '../../utils';\nimport { getQuadrantDefaultConfig } from './util';\nimport { ScatterOptions } from './types';\n\n/**\n * 字段\n * @param params\n */\nfunction geometry(params: Params<ScatterOptions>): Params<ScatterOptions> {\n  const { chart, options } = params;\n  const { data, type, color, shape, size, pointStyle, colorField } = options;\n\n  // 数据\n  chart.data(data);\n\n  // geometry\n  pointAdaptor(\n    deepMix({}, params, {\n      seriesField: colorField,\n      options: {\n        point: {\n          color,\n          shape,\n          size,\n          style: pointStyle,\n        },\n      },\n    })\n  );\n\n  const geometry = findGeometry(chart, 'point');\n\n  // 数据调整\n  if (type) {\n    geometry.adjust(type);\n  }\n\n  return params;\n}\n\n/**\n * meta 配置\n * @param params\n */\nfunction meta(params: Params<ScatterOptions>): Params<ScatterOptions> {\n  const { options } = params;\n  const { xAxis, yAxis, xField, yField } = options;\n\n  return flow(\n    scale({\n      [xField]: xAxis,\n      [yField]: yAxis,\n    })\n  )(params);\n}\n\n/**\n * axis 配置\n * @param params\n */\nfunction axis(params: Params<ScatterOptions>): Params<ScatterOptions> {\n  const { chart, options } = params;\n  const { xAxis, yAxis, xField, yField } = options;\n\n  chart.axis(xField, xAxis);\n  chart.axis(yField, yAxis);\n\n  return params;\n}\n\n/**\n * legend 配置\n * @param params\n */\nfunction legend(params: Params<ScatterOptions>): Params<ScatterOptions> {\n  const { chart, options } = params;\n  const { legend, colorField, shapeField, sizeField } = options;\n\n  if (legend) {\n    chart.legend(colorField || shapeField, legend);\n  } else {\n    chart.legend(false);\n  }\n\n  // 隐藏连续图例\n  if (sizeField) {\n    chart.legend(sizeField, false);\n  }\n\n  return params;\n}\n\n/**\n * 数据标签\n * @param params\n */\nfunction label(params: Params<ScatterOptions>): Params<ScatterOptions> {\n  const { chart, options } = params;\n  const { label, yField } = options;\n\n  const scatterGeometry = findGeometry(chart, 'point');\n\n  // label 为 false, 空 则不显示 label\n  if (!label) {\n    scatterGeometry.label(false);\n  } else {\n    const { callback, ...cfg } = label;\n    scatterGeometry.label({\n      fields: [yField],\n      callback,\n      cfg,\n    });\n  }\n\n  return params;\n}\n\n/**\n * annotation 配置\n * - 特殊 annotation: quadrant(四象限)\n * @param params\n */\nfunction scatterAnnotation(params: Params<ScatterOptions>): Params<ScatterOptions> {\n  const { options } = params;\n  const { quadrant } = options;\n\n  const annotationOptions = [];\n\n  if (quadrant) {\n    const { xBaseline = 0, yBaseline = 0, labels, regionStyle, lineStyle } = quadrant;\n    const defaultConfig = getQuadrantDefaultConfig(xBaseline, yBaseline);\n    // 仅支持四象限\n    const quadrants = new Array(4).join(',').split(',');\n    quadrants.forEach((_: string, index: number) => {\n      annotationOptions.push(\n        {\n          type: 'region',\n          top: false,\n          ...defaultConfig.regionStyle[index].position,\n          style: deepMix({}, defaultConfig.regionStyle[index].style, regionStyle?.[index]),\n        },\n        {\n          type: 'text',\n          top: true,\n          ...deepMix({}, defaultConfig.labelStyle[index], labels?.[index]),\n        }\n      );\n    });\n    // 生成坐标轴\n    annotationOptions.push(\n      {\n        type: 'line',\n        top: false,\n        start: ['min', yBaseline],\n        end: ['max', yBaseline],\n        style: deepMix({}, defaultConfig.lineStyle, lineStyle),\n      },\n      {\n        type: 'line',\n        top: false,\n        start: [xBaseline, 'min'],\n        end: [xBaseline, 'max'],\n        style: deepMix({}, defaultConfig.lineStyle, lineStyle),\n      }\n    );\n  }\n\n  return flow(annotation(annotationOptions))(params);\n}\n\n/**\n * 散点图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params: Params<ScatterOptions>) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(geometry, meta, axis, legend, tooltip, label, interaction, scatterAnnotation, animation, theme)(params);\n}\n"]}