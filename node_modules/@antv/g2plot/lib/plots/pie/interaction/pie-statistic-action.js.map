{"version":3,"file":"pie-statistic-action.js","sourceRoot":"","sources":["../../../../src/plots/pie/interaction/pie-statistic-action.ts"],"names":[],"mappings":"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","sourcesContent":["import { Action } from '@antv/g2/lib/interaction';\nimport { ComponentOption } from '@antv/g2/lib/interface';\nimport { each, get, isFunction } from '@antv/util';\n\n/**\n * Pie 中心文本事件的 Action\n */\nexport class StatisticAction extends Action {\n  private initialAnnotation;\n\n  private getAnnotations() {\n    const view = this.context.view;\n    return view.getComponents().filter((co) => co.type === 'annotation');\n  }\n\n  private getInitialAnnotation(): ComponentOption[] | null {\n    return this.initialAnnotation;\n  }\n\n  init() {\n    const { view } = this.context;\n    view.removeInteraction('tooltip');\n  }\n\n  public change() {\n    const { view, event } = this.context;\n    const annotations = this.getAnnotations();\n    if (!this.initialAnnotation) {\n      this.initialAnnotation = annotations;\n    }\n\n    const { data } = event.data;\n    if (data) {\n      const annotationController = view.getController('annotation');\n      // todo remove ignore\n      // @ts-ignore\n      annotationController.clear(true);\n      // @ts-ignore\n      const [, angleField, colorField] = view.getScaleFields();\n      const angleScale = view.getScaleByField(angleField);\n      const colorScale = view.getScaleByField(colorField);\n\n      const annotationOptions = annotations.filter((a) => get(a, 'extra.key') !== 'statistic').map((a) => a.extra);\n      const statisticOptions = annotations.filter((a) => get(a, 'extra.key') === 'statistic').map((a) => a.extra || {});\n\n      each(statisticOptions, (options, idx) => {\n        let value;\n        if (idx === 0) {\n          // title\n          value = colorScale ? colorScale.getText(data[colorField]) : null;\n        } else {\n          value = angleScale ? angleScale.getText(data[angleField]) : data[angleField];\n        }\n\n        annotationOptions.push({\n          ...options,\n          content: options.formatter ? options.formatter(data, view.getData()) : value,\n        });\n      });\n      annotationOptions.forEach((opt) => {\n        // todo remove ignore\n        // @ts-ignore\n        annotationController.annotation(opt);\n      });\n      view.render(true);\n    }\n  }\n\n  public reset() {\n    const { view } = this.context;\n    const annotationController = view.getController('annotation');\n    // todo remove ignore\n    // @ts-ignore\n    annotationController.clear(true);\n    const initialStatistic = this.getInitialAnnotation();\n    each(initialStatistic, (a) => {\n      view.annotation().text(get(a, 'extra', {}));\n    });\n    view.render(true);\n  }\n}\n"]}