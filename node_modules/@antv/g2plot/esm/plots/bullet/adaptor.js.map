{"version":3,"file":"adaptor.js","sourceRoot":"","sources":["../../../src/plots/bullet/adaptor.ts"],"names":[],"mappings":"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","sourcesContent":["import { deepMix, isNumber } from '@antv/util';\nimport { Params } from '../../core/adaptor';\nimport { interaction, animation, theme, tooltip } from '../../adaptor/common';\nimport { flow, pick } from '../../utils';\nimport { AXIS_META_CONFIG_KEYS } from '../../constant';\nimport { interval, point } from '../../adaptor/geometries';\nimport { BulletOptions } from './types';\nimport { transformData } from './utils';\n\n/**\n * geometry 处理\n * @param params\n */\nfunction geometry(params: Params<BulletOptions>): Params<BulletOptions> {\n  const { chart, options } = params;\n  const { style, targetField, rangeField, measureField, xField, color, layout, size } = options;\n  // 处理数据\n  const { min, max, ds } = transformData(options);\n\n  // 需要统一比列尺\n  chart.scale({\n    [measureField]: {\n      min,\n      max,\n    },\n    [rangeField]: {\n      sync: `${measureField}`,\n    },\n    [targetField]: {\n      sync: `${measureField}`,\n    },\n  });\n  chart.data(ds);\n  chart.axis(`${rangeField}`, false);\n  chart.axis(`${targetField}`, false);\n\n  // rangeGeometry\n  const r = deepMix({}, params, {\n    options: {\n      xField: xField,\n      yField: rangeField,\n      seriesField: 'rKey',\n      isStack: true,\n      interval: {\n        color: color?.range,\n        style: style?.range,\n        size: size?.range,\n      },\n    },\n  });\n  interval(r);\n  // 范围值的 tooltip 隐藏掉\n  chart.geometries[0].tooltip(false);\n\n  // measureGeometry\n  const m = deepMix({}, params, {\n    options: {\n      xField: xField,\n      yField: measureField,\n      seriesField: 'mKey',\n      isStack: true,\n      interval: {\n        color: color?.measure,\n        style: style?.measure,\n        size: size?.measure,\n      },\n    },\n  });\n  interval(m);\n\n  // targetGeometry\n  const t = deepMix({}, params, {\n    options: {\n      xField: xField,\n      yField: targetField,\n      seriesField: 'tKey',\n      point: {\n        color: color?.target,\n        style: style?.target,\n        size: isNumber(size?.target) ? Number(size.target) / 2 : size.target,\n        shape: layout === 'horizontal' ? 'line' : 'hyphen',\n      },\n    },\n  });\n  point(t);\n\n  // 水平的时候，要转换坐标轴\n  if (layout === 'horizontal') {\n    chart.coordinate().transpose();\n  }\n\n  return params;\n}\n\n/**\n * meta 配置\n * @param params\n */\nfunction meta(params: Params<BulletOptions>): Params<BulletOptions> {\n  const { chart, options } = params;\n  const { xAxis, yAxis, meta, targetField, rangeField, measureField, xField } = options;\n\n  if (meta) {\n    const scales = deepMix({}, meta, {\n      [xField]: pick(xAxis, AXIS_META_CONFIG_KEYS),\n      [measureField]: pick(yAxis, AXIS_META_CONFIG_KEYS),\n      [targetField]: {\n        sync: `${measureField}`,\n      },\n      [rangeField]: {\n        sync: `${measureField}`,\n      },\n    });\n    chart.scale(scales);\n  }\n\n  return params;\n}\n/**\n * axis 配置\n * @param params\n */\nfunction axis(params: Params<BulletOptions>): Params<BulletOptions> {\n  const { chart, options } = params;\n  const { xAxis, yAxis, xField, measureField } = options;\n\n  // 为 false 则是不显示轴\n  if (xAxis === false) {\n    chart.axis(`${xField}`, false);\n  } else {\n    chart.axis(`${xField}`, xAxis);\n  }\n\n  if (yAxis === false) {\n    chart.axis(`${measureField}`, false);\n  } else {\n    chart.axis(`${measureField}`, yAxis);\n  }\n\n  return params;\n}\n\n/**\n * legend 配置\n * @param params\n */\nfunction legend(params: Params<BulletOptions>): Params<BulletOptions> {\n  const { chart, options } = params;\n  const { legend } = options;\n  chart.removeInteraction('legend-filter');\n  // @TODO 后续看是否内部自定义一个 legend\n  chart.legend(legend);\n\n  // 默认关闭掉所在 color 字段的 legend, 从而不影响自定义的legend\n  chart.legend('rKey', false);\n  chart.legend('mKey', false);\n  chart.legend('tKey', false);\n\n  return params;\n}\n\n/**\n * label 配置\n * @param params\n */\nfunction label(params: Params<BulletOptions>): Params<BulletOptions> {\n  const { chart, options } = params;\n  const { label, measureField, targetField, rangeField } = options;\n  const [rangeGeometry, measureGeometry, targetGeometry] = chart.geometries;\n\n  if (label?.range) {\n    rangeGeometry.label(`${rangeField}`, label.range);\n  }\n  if (label?.measure) {\n    measureGeometry.label(`${measureField}`, label.measure);\n  }\n  if (label?.target) {\n    targetGeometry.label(`${targetField}`, label.target);\n  }\n\n  return params;\n}\n\n/**\n * 子弹图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params: Params<BulletOptions>) {\n  // flow 的方式处理所有的配置到 G2 API\n  flow(geometry, meta, axis, legend, theme, label, tooltip, interaction, animation)(params);\n}\n"]}